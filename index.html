<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salesforce Chatbot Tester</title>
</head>
<body>
  <h1>Salesforce Embedded Messaging â€“ MembershipNumber tester</h1>
  <p>Enter Membership number to preload in the chat.</p>

  <label for="membershipInput">Membership Number:</label>
  <input type="text" id="membershipInput" value="9897960067" />
  <button onclick="reloadBot()">Reload Chatbot</button>

  <script type="text/javascript">
    let firstLoad = true;

    function destroyEmbeddedMessaging() {
      // Remove existing iframe and wrapper if they exist
      const iframe = document.querySelector('iframe.embeddedMessagingIframe');
      if (iframe) iframe.remove();

      const wrapper = document.getElementById('embedded-messaging-frame');
      if (wrapper) wrapper.remove();

      // Clear bootstrap object to allow re-initialization
      window.embeddedservice_bootstrap = undefined;
    }

    function reloadBot() {
      const membershipNumber = document.getElementById('membershipInput').value;

      if (!firstLoad) {
        destroyEmbeddedMessaging();
      } else {
        firstLoad = false;
      }

      // Dynamically load the Salesforce embedded messaging script
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://collinsonlifestyle2023--cdc.sandbox.my.site.com/ESWGitHubTest1752671269272/assets/js/bootstrap.min.js';
      script.onload = () => {
        window.addEventListener("onEmbeddedMessagingReady", () => {
          embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
            "MembershipNumber": membershipNumber
          });
        });

        embeddedservice_bootstrap.settings.language = 'en_US';

        embeddedservice_bootstrap.init(
          '00DQz000004pGwT',
          'Chatbot',
          'https://collinsonlifestyle2023--cdc.sandbox.my.site.com/ESWGitHubTest1752671269272',
          {
            scrt2URL: 'https://collinsonlifestyle2023--cdc.sandbox.my.salesforce-scrt.com'
          }
        );
      };
      document.body.appendChild(script);
    }

    window.onload = reloadBot;
  </script>
</body>
</html>
